<script>
    const approvalMixin = {
        data() {
            return {
                disabledFieldsForStandardUsers: ['name', 'created_date'],
                disabledFieldsForAdminUsers: [],
                showEditBtn: true,
                showDeleteBtn: true,
                showAddNewBtn: true,
            }
        },
        methods: {
            computeStageWiseTotalCount() {
                // Initialize or reset the stage-wise count
                let stageCounts = {
                    "Lead": 0,
                    "Contacted": 0,
                    "Pitched": 0,
                    "Sent Demo": 0,
                    "Negotiating": 0,
                    "Closed-Won": 0,
                    "Closed-Lost": 0
                };

                // Iterate over the filtered data to compute counts
                this.dataTable.forEach(item => {
                    if (item.stage in stageCounts) {
                        stageCounts[item.stage]++;
                    }
                });
                stageCounts['All']=this.dataTable.length;

                // Update the data property with the computed counts
                this.stageWiseCount = stageCounts;
            },
            filterDataOnRoleBasis: function () {
                if (!this.currentUser || !this.schema) {
                    return;
                }
                let { role, email, name } = this.currentUser;
                switch (role) {
                    case 'standard':
                        this.dataTable = this.dataTable.filter(item => item['assigned_to'] === email)
                        this.schema.forEach((item) => {
                            if (item.key === 'assigned_to' && item.options.length) {
                                item.options = item.options.filter(o => o.Email === this.currentUser.email)
                            }
                        }
                        );

                        this.disabledFieldsForStandardUsers.forEach((item) => {
                            this.schema.forEach((item) => {
                                if (item.key === item) {
                                    item.disabled = true
                                }
                            }
                            );
                        });
                        break;
                    case 'admin':
                        // remove user having role as owner from the options of assigned_to field
                        this.schema.forEach((item) => {
                            if (item.key === 'assigned_to' && item.options.length) {
                                item.options = item.options.filter(o => o.Role !== 'owner')
                            }
                        }
                        );
                        break;
                    default:
                        break;
                }
                this.computeStageWiseTotalCount();
            },
        }
    }
</script>
