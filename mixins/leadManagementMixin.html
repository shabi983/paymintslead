<script>
    const leadManagmentMixin = {
        data() {
            return {
                colorsForLeads: {
                    "All": "#7c959c",
                    "Lead": "#2ce6ff",
                    "Contacted": "#09c8c6",
                    "Pitched": "#098ec8",
                    "Sent Demo": "#cb00ff",
                    "Negotiating": "#ffa700",
                    "Closed-Won": "#09c849",
                    "Closed-Lost": "#ff338e"
                },
                selectedLead: null,
                stageWiseCount: {}
            }
        },
        watch: {
            selectedLead(newStage, oldStage) {
                // filter the data based on the selected lead
                if (newStage) {
                    this.filterDataByLeadStatus(newStage);
                } else {
                    this.dataTable = this.unfilteredDataTable;
                }
            }
        },
        methods: {
            selectLead(lead) {
                this.selectedLead = lead;
            },
            filterDataByLeadStatus(stage) {
                let { role, email, name } = this.currentUser;

                if (role === 'owner') {
                    if (stage === "All") {
                        this.dataTable = this.unfilteredDataTable;
                    } else {
                        const filtered = this.unfilteredDataTable.filter((item) => item.stage === stage);
                        this.dataTable = filtered;
                    }

                    return;
                }

                if (stage === "All") {
                    this.dataTable = this.unfilteredDataTable.filter(item => item['assigned_to'] === email);
                } else {
                    const filtered = this.unfilteredDataTable.filter((item) => item.stage === stage && item['assigned_to'] === email);
                    this.dataTable = filtered;
                }

            },
        }
    }
</script>
